$global:LASTEXITCODE = $null | Out-Null
Clear-Host 

Write-Host "##########################################################" -ForegroundColor Yellow
Write-Host "# Performing unit test of Get-CsmeVulnerabiltyStatus.ps1 #" -ForegroundColor Yellow
Write-Host "#         You must monitor the script for errors.        #" -ForegroundColor Yellow
Write-Host "##########################################################" -ForegroundColor Yellow
Write-Host " "


# Test downloading from the web
Write-Host "Testing script with the -DownloadFromWeb argument. This should work." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb
Write-Host " "

Write-Host "Testing script with the -DownloadFromWeb and valid -WebUrl arguments. This should work." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb -WebUrl http://127.0.0.1/CSME_Version_Detection_Tool_Windows.zip
Write-Host " "

Write-Host "Testing script with the -DownloadFromWeb and invalid -WebUrl arguments. This should error." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb -WebUrl http://127.0.0.1/foobar.zip
Write-Host " "


# Test downloading from SMB
Write-Host "Testing script with -DownloadFromSmb and valid -SmbPath arguments. This should work." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromSmb -SmbPath \\127.0.0.1\csme\CSME_Version_Detection_Tool_Windows.zip
Write-Host " "

Write-Host "Testing script with -DownloadFromSmb and invalid -SmbPath argument. This should error." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromSmb -SmbPath \\foo\bar\foobar.zip
Write-Host " "

Write-Host "Testing script with -DownloadFromSmb and no -SmbPath argument. This should prompt for a path, then work." -ForegroundColor Yellow
Write-Host "You can use the following SMB path when prompted: \\127.0.0.1\csme\CSME_Version_Detection_Tool_Windows.zip"
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromSmb
Write-Host " "


# Test Logging
Write-Host "Testing script with the a -LogDir argument with no path. This should error." -ForegroundColor Yellow
Write-Host "You can use the following SMB path when prompted: \\127.0.0.1\csme\results.txt"
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb -LogDir
Write-Host " "

Write-Host "Testing script with the -LogDir argument and a valid path. This should work." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb -LogDir \\127.0.0.1\csme\
Write-Host " "

Write-Host "Testing script with the -LogDir argument and an invalid path. This should error." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb -LogDir \\foo\bar\
Write-Host " "

# Test the NoCleanUp argument
Write-Host "Testing script with the -NoCleanUp argument. This should work and leave a temporary directory after completion." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb -NoCleanUp
Write-Host " "

# Test for misc. problems with the arguments
Write-Host "Testing script with neither the -DownloadFromWeb or -DownloadFromSmb arguments passed. This should error." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1
Write-Host " "

Write-Host "Testing script with both -DownloadFromWeb and -DownloadFromSmb arguments passed. This should error." -ForegroundColor Yellow
.\Get-CsmeVulerabilityStatus.ps1 -DownloadFromWeb -DownloadFromSmb
Write-Host " "

Write-Host "Testing Complete."